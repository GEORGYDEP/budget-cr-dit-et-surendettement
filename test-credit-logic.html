<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Logique de Cr√©dit</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-result {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #10b981;
        }
        .test-result.error {
            border-left-color: #ef4444;
        }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 30px; }
        .calculation {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
        }
        .success { color: #10b981; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üß™ Test de la Logique de Cr√©dit</h1>
    <p>Ce fichier teste la logique de calcul du cr√©dit pour s'assurer que le budget est correctement √©quilibr√© apr√®s avoir pris un cr√©dit.</p>

    <div id="results"></div>

    <script>
        function runTests() {
            const results = document.getElementById('results');

            // Test 1: Calcul du cr√©dit avec int√©r√™ts
            {
                const deficit = 100;
                const creditCost = Math.round(deficit * 1.15);
                const interestAmount = Math.round(deficit * 0.15);
                const monthlyRepayment = Math.round(creditCost / 12);

                const expected = {
                    creditCost: 115,
                    interestAmount: 15,
                    monthlyRepayment: 10
                };

                const pass = creditCost === expected.creditCost &&
                           interestAmount === expected.interestAmount &&
                           monthlyRepayment === expected.monthlyRepayment;

                results.innerHTML += `
                    <div class="test-result ${pass ? '' : 'error'}">
                        <h2>Test 1: Calcul du cr√©dit avec int√©r√™ts</h2>
                        <div class="calculation">
                            D√©ficit: ${deficit} ‚Ç¨<br>
                            Co√ªt du cr√©dit (15% d'int√©r√™ts): ${creditCost} ‚Ç¨ ${pass ? '‚úÖ' : '‚ùå'}<br>
                            Montant des int√©r√™ts: ${interestAmount} ‚Ç¨ ${pass ? '‚úÖ' : '‚ùå'}<br>
                            Remboursement mensuel (sur 12 mois): ${monthlyRepayment} ‚Ç¨ ${pass ? '‚úÖ' : '‚ùå'}
                        </div>
                        <p class="${pass ? 'success' : 'error'}">${pass ? '‚úÖ Test r√©ussi' : '‚ùå Test √©chou√©'}</p>
                    </div>
                `;
            }

            // Test 2: Budget √©quilibr√© apr√®s cr√©dit
            {
                const originalIncome = 1500;
                const fixedExpenses = 1000;
                const variableExpenses = 600;
                const deficit = originalIncome - fixedExpenses - variableExpenses; // -100

                // Simuler l'application du cr√©dit
                const newIncome = originalIncome + Math.abs(deficit); // 1500 + 100 = 1600
                const resteDisponible = newIncome - fixedExpenses - variableExpenses; // 1600 - 1000 - 600 = 0

                const pass = resteDisponible === 0;

                results.innerHTML += `
                    <div class="test-result ${pass ? '' : 'error'}">
                        <h2>Test 2: Budget √©quilibr√© apr√®s cr√©dit</h2>
                        <div class="calculation">
                            <strong>Avant cr√©dit:</strong><br>
                            Revenus: ${originalIncome} ‚Ç¨<br>
                            D√©penses fixes: ${fixedExpenses} ‚Ç¨<br>
                            D√©penses variables: ${variableExpenses} ‚Ç¨<br>
                            D√©ficit: ${deficit} ‚Ç¨<br>
                            <br>
                            <strong>Apr√®s cr√©dit:</strong><br>
                            Nouveaux revenus: ${newIncome} ‚Ç¨ (+ ${Math.abs(deficit)} ‚Ç¨ de cr√©dit)<br>
                            D√©penses fixes: ${fixedExpenses} ‚Ç¨<br>
                            D√©penses variables: ${variableExpenses} ‚Ç¨<br>
                            Reste disponible: ${resteDisponible} ‚Ç¨ ${pass ? '‚úÖ' : '‚ùå'}
                        </div>
                        <p class="${pass ? 'success' : 'error'}">${pass ? '‚úÖ Budget √©quilibr√© correctement' : '‚ùå Budget non √©quilibr√©'}</p>
                    </div>
                `;
            }

            // Test 3: Affichage du reste disponible dans l'√©cran mensuel (SANS monthlyDebt)
            {
                const monthlyIncome = 1600; // Apr√®s cr√©dit
                const fixedExpenses = 1000;
                const variableExpenses = 600;
                const monthlyDebt = 10; // Remboursement mensuel

                // ANCIEN CALCUL (INCORRECT): inclut monthlyDebt
                const oldReste = monthlyIncome - fixedExpenses - variableExpenses - monthlyDebt; // -10

                // NOUVEAU CALCUL (CORRECT): n'inclut PAS monthlyDebt
                const newReste = monthlyIncome - fixedExpenses - variableExpenses; // 0

                const pass = newReste === 0;

                results.innerHTML += `
                    <div class="test-result ${pass ? '' : 'error'}">
                        <h2>Test 3: Affichage du reste disponible (FIX PRINCIPAL)</h2>
                        <div class="calculation">
                            Revenus pr√©vus: ${monthlyIncome} ‚Ç¨<br>
                            D√©penses fixes: ${fixedExpenses} ‚Ç¨<br>
                            D√©penses variables: ${variableExpenses} ‚Ç¨<br>
                            Dette mensuelle: ${monthlyDebt} ‚Ç¨<br>
                            <br>
                            <strong>Ancien calcul (INCORRECT):</strong><br>
                            Reste = ${monthlyIncome} - ${fixedExpenses} - ${variableExpenses} - ${monthlyDebt} = ${oldReste} ‚Ç¨ ‚ùå<br>
                            ‚Üí Le reste est n√©gatif m√™me apr√®s avoir pris un cr√©dit!<br>
                            <br>
                            <strong>Nouveau calcul (CORRECT):</strong><br>
                            Reste = ${monthlyIncome} - ${fixedExpenses} - ${variableExpenses} = ${newReste} ‚Ç¨ ‚úÖ<br>
                            ‚Üí Le budget est √©quilibr√©!<br>
                            <br>
                            <em>Note: La dette mensuelle (${monthlyDebt} ‚Ç¨) est d√©duite du solde r√©el chaque mois,<br>
                            pas du reste budg√©taire pr√©visionnel.</em>
                        </div>
                        <p class="${pass ? 'success' : 'error'}">${pass ? '‚úÖ Reste disponible affich√© correctement' : '‚ùå Reste disponible incorrect'}</p>
                    </div>
                `;
            }

            // Test 4: Impact sur le solde r√©el chaque mois
            {
                const initialBalance = 500;
                const monthlyIncome = 1600;
                const fixedExpenses = 1000;
                const variableExpenses = 600;
                const monthlyDebt = 10;

                // Calcul du nouveau solde apr√®s un mois
                const monthlyExpenses = fixedExpenses + variableExpenses + monthlyDebt;
                const newBalance = initialBalance + monthlyIncome - monthlyExpenses;

                const expectedBalance = 490; // 500 + 1600 - 2110 = -10? Non: 500 + 1600 - 1610 = 490
                const pass = newBalance === expectedBalance;

                results.innerHTML += `
                    <div class="test-result ${pass ? '' : 'error'}">
                        <h2>Test 4: Impact sur le solde r√©el chaque mois</h2>
                        <div class="calculation">
                            Solde initial: ${initialBalance} ‚Ç¨<br>
                            Revenus mensuels: ${monthlyIncome} ‚Ç¨<br>
                            D√©penses mensuelles totales: ${monthlyExpenses} ‚Ç¨ (fixes + variables + dette)<br>
                            ‚Üí ${fixedExpenses} + ${variableExpenses} + ${monthlyDebt} = ${monthlyExpenses} ‚Ç¨<br>
                            <br>
                            Nouveau solde: ${initialBalance} + ${monthlyIncome} - ${monthlyExpenses} = ${newBalance} ‚Ç¨ ${pass ? '‚úÖ' : '‚ùå'}
                        </div>
                        <p class="${pass ? 'success' : 'error'}">${pass ? '‚úÖ Solde calcul√© correctement' : '‚ùå Solde incorrect'}</p>
                        <p><em>Le remboursement de la dette (${monthlyDebt} ‚Ç¨/mois) r√©duit progressivement le solde sur 12 mois,<br>
                        pour un co√ªt total de ${monthlyDebt * 12} ‚Ç¨ (incluant ${(monthlyDebt * 12) - 100} ‚Ç¨ d'int√©r√™ts).</em></p>
                    </div>
                `;
            }

            // R√©sum√©
            const allPassed = document.querySelectorAll('.test-result.error').length === 0;
            results.innerHTML += `
                <div class="test-result ${allPassed ? '' : 'error'}" style="margin-top: 30px; border-width: 4px;">
                    <h2>üéØ R√©sum√© des Tests</h2>
                    <p class="${allPassed ? 'success' : 'error'}" style="font-size: 1.2em;">
                        ${allPassed ? '‚úÖ Tous les tests sont r√©ussis! La logique de cr√©dit fonctionne correctement.' : '‚ùå Certains tests ont √©chou√©. V√©rifiez la logique.'}
                    </p>
                    <h3>Corrections apport√©es:</h3>
                    <ol>
                        <li>‚úÖ Le reste disponible est calcul√© SANS inclure monthlyDebt dans showMonthlyEvent()</li>
                        <li>‚úÖ Le cr√©dit √©quilibre le budget pr√©visionnel (reste = 0)</li>
                        <li>‚úÖ La dette mensuelle est d√©duite du solde r√©el, pas du budget pr√©visionnel</li>
                        <li>‚úÖ Ajout de logs de diagnostic pour tracer le flux</li>
                    </ol>
                </div>
            `;
        }

        // Ex√©cuter les tests au chargement
        runTests();
    </script>
</body>
</html>
